// backend/scripts/copy-generated.js
const fs = require("fs-extra");
const path = require("path");

const DEFAULT_SRC = path.resolve(__dirname, "../generated/zod"); // generated by prisma
// Destination: passed as CLI arg, or env var FRONTEND_DST, or default sibling ../frontend/src/generated/zod
const DEST = process.argv[2]
  || process.env.FRONTEND_DST
  || path.resolve(__dirname, "../..", "frontend", "src", "generated", "zod");

(async () => {
  try {
    if (!(await fs.pathExists(DEFAULT_SRC))) {
      console.error(`Source not found: ${DEFAULT_SRC}`);
      console.error("Run `npm run prisma:generate` first or check your prisma generator output path.");
      process.exit(1);
    }
    await fs.remove(DEST); // remove existing
    await fs.copy(DEFAULT_SRC, DEST, { overwrite: true });
    console.log(`Copied generated zod schemas:\n  from: ${DEFAULT_SRC}\n  to:   ${DEST}`);
  } catch (err) {
    console.error("Failed to copy generated zod schemas:", err);
    process.exit(1);
  }
})();
